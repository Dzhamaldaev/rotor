#!/usr/bin/env php
<?php

use Phinx\Config\Config;
use Symfony\Component\Console\Event\ConsoleCommandEvent;
use Symfony\Component\Console\ConsoleEvents;
use Symfony\Component\EventDispatcher\EventDispatcher;

require __DIR__ . '/app/bootstrap.php';

$app = new Phinx\Console\PhinxApplication();
$app->setName('RotorCMS by Vantuz - http://visavi.net');
$app->setVersion(VERSION);

$app->addCommands([
    new \App\Commands\Install(),
    new \App\Commands\KeyGenerate(),
    new \App\Commands\CacheClear(),
]);


$dispatcher = new EventDispatcher();
$dispatcher->addListener(ConsoleEvents::COMMAND, function (ConsoleCommandEvent $event) {
    $command = $event->getCommand();

    if ($command instanceof Phinx\Console\Command\AbstractCommand) {
        $command->setConfig(new Config(require APP . '/migration.php'));
    }
});

$app->setDispatcher($dispatcher);
$app->run();
